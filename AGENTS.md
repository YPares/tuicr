# Coding Agent Instructions for tuicr Reviews

This document explains how to interpret and respond to code review feedback generated by `tuicr`.

## Review Format

When a user reviews your changes with `tuicr`, they will provide you with a structured Markdown document. Here's how to interpret it:

### Document Structure

```markdown
# Code Review: {project_name}

**Reviewed:** {timestamp}
**Base Commit:** `{commit_sha}`
**Files Reviewed:** {reviewed_count}/{total_count}

## Summary
{optional overall notes}

## Files
{per-file feedback}

## Action Items
{prioritized list of issues to address}
```

### Comment Types

Comments are tagged with one of four types:

| Type | Meaning | Action Required |
|------|---------|-----------------|
| **[ISSUE]** | Problem that must be fixed | Yes - address before proceeding |
| **[SUGGESTION]** | Improvement recommendation | Consider implementing |
| **[NOTE]** | Observation or question | Respond or acknowledge |
| **[PRAISE]** | Positive feedback | No action needed |

### File Status Markers

- `[A]` - Added (new file)
- `[M]` - Modified (existing file changed)
- `[D]` - Deleted
- `[R]` - Renamed

### Review Status

- `[REVIEWED]` - Reviewer has examined this file
- `[PENDING]` - File has not been reviewed yet

## How to Respond

### 1. Address Action Items First

The "Action Items" section at the bottom contains all **[ISSUE]** comments. These are blocking and should be addressed before other changes:

```markdown
## Action Items

1. **`src/auth.rs`:42** - Magic number should be a named constant
2. **`src/api.rs`:15** - Missing error handling for network failure
```

For each action item:
- Navigate to the specified file and line
- Make the requested change
- If you disagree with the feedback, explain your reasoning

### 2. Consider Suggestions

**[SUGGESTION]** comments are non-blocking but should be considered:

```markdown
> **[SUGGESTION]** Consider using `HashMap` instead of `Vec` for O(1) lookups
```

Either:
- Implement the suggestion, or
- Explain why you chose a different approach

### 3. Answer Questions

**[NOTE]** comments often contain questions:

```markdown
> **[NOTE]** Why is this function marked as `unsafe`?
```

Provide a brief explanation in your response.

### 4. Acknowledge File-Level Comments

File-level comments apply to the entire file, not a specific line:

```markdown
### M `src/auth.rs` [REVIEWED]

#### File Comments
> **[SUGGESTION]** Consider adding unit tests for the new validation logic
```

## Response Format

When responding to a review, structure your response as:

```markdown
## Changes Made

### Issues Addressed
- `src/auth.rs:42` - Extracted magic number to `TOKEN_EXPIRY_SECONDS` constant
- `src/api.rs:15` - Added error handling with retry logic

### Suggestions Implemented
- `src/utils.rs` - Replaced Vec with HashMap as suggested

### Suggestions Declined
- `src/config.rs` - Kept current approach because [reason]

### Questions Answered
- The `unsafe` block in `src/ffi.rs` is required for FFI calls to the C library
```

## Example Review and Response

### Input (Review from tuicr)

```markdown
# Code Review: my-project

**Files Reviewed:** 2/2

## Files

### M `src/main.rs` [REVIEWED]

#### Line Comments
```rust
// Line 15
    let timeout = 30;
```
> **[ISSUE]** Magic number - extract to a named constant

```rust
// Line 42-45
    match result {
        Ok(v) => v,
        Err(_) => panic!("failed"),
    }
```
> **[SUGGESTION]** Use `?` operator instead of panic

### A `src/config.rs` [REVIEWED]

#### File Comments
> **[NOTE]** Should this support environment variable overrides?

## Action Items

1. **`src/main.rs`:15** - Magic number - extract to a named constant
```

### Expected Response

```markdown
## Changes Made

### Issues Addressed
- `src/main.rs:15` - Extracted to `const DEFAULT_TIMEOUT_SECS: u64 = 30;`

### Suggestions Implemented
- `src/main.rs:42-45` - Replaced panic with `?` operator, now returns `Result`

### Questions Answered
- `src/config.rs` - Yes, added support for `APP_CONFIG_PATH` environment variable override
```

## Tips for Agents

1. **Read the full review** before making changes
2. **Prioritize [ISSUE] items** - these are blocking
3. **Preserve reviewer intent** - don't over-engineer solutions
4. **Be concise** in your response
5. **If unclear**, ask for clarification rather than guessing
